1 Introduction
--------------
This document provides information about data schema for the Change-Life-Cycle module of IRIS project, including the following:

* Table schema
* Raw event data

2 Purpose
---------
The purpose is to collect comprehensive information worth demonstrating in the life of a patch, thus using it as fundamental data to establish the database for the Change-Life-Cycle module.

3 Table Schema
--------------
This section describes the table schema, including the following:

* Change table
* PatchSet table
* Tag table
* SR table
* SRAction table
* Snapshot table
* Image table
* Snapshot-Manifest table
* Image-Manifest table

3.1 Change Table
````````````````
Change data is obtained by using Gerrit REST API and stored in the table below:

+------------------------+-------------+----------+--------------------------+----------------------------------+
|Field                   |Type         |Key/Index |Note                      |Data Source                       |
+========================+=============+==========+==========================+==================================+
|Number                  |Int          |PK        |                          |res.number                        |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Project                 |Varchar(255) |Index     |                          |res.project                       |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Branch                  |Varchar(64)  |          |                          |res.branch                        |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Merged_patchset_number  |Int          |Index     |Default: 0                |res.revision                      |
|                        |             |          |                          |.patchset._number                 |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Subject                 |Text         |          |                          |res.subject                       |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Owner                   |Varchar(255) |Index     |                          |res.owner.name                    |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Owner_org               |Varchar(128) |          |Organization of the owner |                                  |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Owner_email             |Varchar(128) |          |                          |                                  |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Change_id               |Varchar(128) |          |Change-ID line            |res.id                            |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|url                     |Varchar(255) |          |URL that links to web UI  |                                  |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Created_at              |Datetime     |Index     |Null=true                 |res.created                       |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Updated_at              |Datetime     |Index     |                          |res.updated                       |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Status                  |Int          |Index     |- Reviewing               |res.status                        |
|                        |             |          |- Merged                  |                                  |
|                        |             |          |- Abandoned               |                                  |
+------------------------+-------------+----------+--------------------------+----------------------------------+


3.2 Patchset Table
``````````````````
Patchset data is obtained by using Gerrit REST API and stored in the table below:

+------------------------+-------------+----------+--------------------------+----------------------------------+
|Field                   |Type         |Key/Index |Note                      |Data Source                       |
+========================+=============+==========+==========================+==================================+
|id                      |Varchar(255) |PK        |                          |res.revision.patchset             |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Change                  |             |FK        |                          |change.number                     |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Subject                 |Text         |          |                          |res.revisions.commit.subject      |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Number                  |Int          |PK        |                          |res.number                        |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Uploader                |Varchar(255) |Index     |                          |res.revisions.commit.committer    |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Uploader_org            |Varchar(128) |Index     |                          |                                  |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Uploader_email          |Varchar(128) |Index     |                          |                                  |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Commit                  |Varchar(255) |Index     |                          |res.revisions.patchset            |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Created_at              |Datetime     |Index     |                          |res.revisions.commit.committer.   |
|                        |             |          |                          |date                              |
+------------------------+-------------+----------+--------------------------+----------------------------------+


3.3 Tag Table
``````````````
Tag data is obtained from Git cache by using OSC API and stored in the table below:

+------------------------+-------------+----------+--------------------------+----------------------------------+
|Field                   |Type         |Key/Index |Note                      |Data Source                       |
+========================+=============+==========+==========================+==================================+
|id                      |Varchar(255) |PK        |                          |git show-ref                      |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Tag                     |Varchar(255) |Index     |                          |SR.tag                            |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Project                 |Varchar(255) |          |                          |SR.description.Git_project        |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Branch                  |Varchar(255) |          |                          |SR.tag.split                      |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Commit                  |Varchar(255) |Index     |                          |(git cat-file).split              |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Patchset                |             |          |                          |(git cat-file).split              |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Tagger                  |Varchar(255) |Index     |                          |(git cat-file).split              |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Tagger_org              |Varchar(128) |          |                          |                                  |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Tagger_email            |Varchar(128) |          |                          |                                  |
+------------------------+-------------+----------+--------------------------+----------------------------------+

3.4 SR Table
````````````
SR data is obtained by using OSC API and stored in the table below:

+------------------------+-------------+----------+--------------------------+----------------------------------+
|Field                   |Type         |Key/Index |Note                      |Data Source                       |
+========================+=============+==========+==========================+==================================+
|id                      |Int          |PK        |                          |OSC_SR.id                         |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Tag                     |             |          |                          |OSC_SR.description.tag            |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Target_project          |Varchar(255) |          |                          |OSC_SR.action.tgt_project         |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Target_package          |Varchar(255) |          |                          |OSC_SR.action.tgt_package         |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Source_project          |Varchar(255) |          |                          |OSC_SR.action.src_project         |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Source_package          |Varchar(255) |          |                          |OSC_SR.action.src_package         |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Source_revision         |Varchar(64)  |          |                          |OSC_SR.action.src_rev             |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Status                  |Varchar(64)  |          |- Sent                    |OSC_SR.state.name                 |
|                        |             |          |- Created                 |                                  |
|                        |             |          |- Accepted                |                                  |
|                        |             |          |- Revoked                 |                                  |
|                        |             |          |- Rejected                |                                  |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Description             |Text         |          |                          |OSC_SR.description                |
+------------------------+-------------+----------+--------------------------+----------------------------------+

3.5 SRAction Table
``````````````````
SRAction data is obtained by using OSC API and stored in the table below:

+------------------------+-------------+----------+--------------------------+----------------------------------+
|Field                   |Type         |Key/Index |Note                      |Data Source                       |
+========================+=============+==========+==========================+==================================+
|Name                    |Varchar(64)  |PK        |- Sent                    |OSC_SR.state.name                 |
|                        |             |          |- Created                 |                                  |
|                        |             |          |- Accepted                |                                  |
|                        |             |          |- Revoked                 |                                  |
|                        |             |          |- Rejected                |                                  |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|SR                      |Int          |PK        |                          |OSC_SR.id                         |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|At                      |Datetime     |          |                          |OSC_SR.state.when                 |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Who                     |Varchar(255) |Index     |Who perform this action   |OSC_SR.state.who                  |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Who_org                 |Varchar(128) |          |                          |                                  |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Who_email               |Varchar(128) |          |                          |                                  |
+------------------------+-------------+----------+--------------------------+----------------------------------+

3.6 Snapshot Table
``````````````````
Snapshot data is obtained from mirror download server and stored in the table below:.

+------------------------+-------------+----------+--------------------------+----------------------------------+
|Field                   |Type         |Key/Index |Note                      |Data Source                       |
+========================+=============+==========+==========================+==================================+
|id                      |Varchar(255) |PK        |                          |Branch, Vertical, Release_id,     |
|                        |             |          |                          |Build_id                          |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Build_id                |Varchar(255) |          |                          |$snapshot/buiddata/build.xml/<id> |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Branch                  |Varchar(255) |          |eg: tizen                 |Path                              |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Vertical                |Varchar(255) |          |eg: ivi                   |Path                              |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Release                 |Varchar(255) |          |eg: daily, weekly         |Path                              |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|c                       |Boolean      |          |                          |                                  |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|Archs                   |Varchar(255) |          |eg: x86_64                |$snapshot/buiddata/build.xml/     |
|                        |             |          |                          |<archs>                           |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|At                      |Datetime     |          |                          |Dir ctime                         |
+------------------------+-------------+----------+--------------------------+----------------------------------+

3.7 Image table
``````````````````
image data is obtained from mirror download server.

+------------------------+-------------+----------+--------------------------+----------------------------------+
|field                   |type         |key/index |note                      |data source                       |
+========================+=============+==========+==========================+==================================+
|id                      |varchar(255) |PK        |                          |branch, vertical, release_id,     |
|                        |             |          |                          |build_id                          |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|build_id                |varchar(255) |          |                          |$snapshot/buiddata/build.xml/<id> |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|branch                  |varchar(255) |          |eg: tizen                 |path                              |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|vertical                |varchar(255) |          |eg: ivi                   |path                              |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|release                 |varchar(255) |          |eg: daily, weekly         |path                              |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|c                       |boolean      |          |                          |                                  |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|archs                   |varchar(255) |          |eg: x86_64                |$snapshot/buiddata/build.xml/     |
|                        |             |          |                          |<archs>                           |
+------------------------+-------------+----------+--------------------------+----------------------------------+
|at                      |datetime     |          |                          |dir ctime                         |
+------------------------+-------------+----------+--------------------------+----------------------------------+

3.8 Snapshot-Manifest Table (many to many relationship)
```````````````````````````````````````````````````````
Manifest data is obtained from mirror download server and stored in the table below:

+------------------------+-------------+-------------+------------------------+---------------------------------+
|field                   |type         |key/index    |note                    |data source                      |
+========================+=============+=============+========================+=================================+
|id                      |varchar(255) |PK           |                        |Snapshot.name+arch               |
+------------------------+-------------+-------------+------------------------+---------------------------------+
|Snapshot                |             |FK:          |                        |                                 |
|                        |             |Snapshot.id  |                        |                                 |
+------------------------+-------------+-------------+------------------------+---------------------------------+
|File_name               |             |             |                        |File.name                        |
+------------------------+-------------+-------------+------------------------+---------------------------------+
|Arch                    |Varchar(255) |             |                        |File_name.arch                   |
+------------------------+-------------+-------------+------------------------+---------------------------------+
|Tag                     |             |FK:          |                        |$snapshot/buiddata/manifest/     |
|                        |             |tag.project, |                        |$repo.xml/<path>,                |
|                        |             |tag.tag      |                        |$snapshot/buiddata/manifest/     |
|                        |             |             |                        |/$repo.xml/<revision>.start      |
+------------------------+-------------+-------------+------------------------+---------------------------------+

bined primary key: (snapshot_id, tag_id)

3.9 Image-Manifest Table (many to many relationship)
````````````````````````````````````````````````````
Manifest data is obtained from mirror download server and stored in the table below:

+------------------------+-------------+-------------+------------------------+---------------------------------+
|field                   |type         |key/index    |note                    |data source                      |
+========================+=============+=============+========================+=================================+
|id                      |Varchar(255) |PK           |                        |image_name                       |
+------------------------+-------------+-------------+------------------------+---------------------------------+
|File_name               |Varchar(255) |             |                        |File.name                        |
+------------------------+-------------+-------------+------------------------+---------------------------------+
|Image                   |             |FK:          |                        |                                 |
|                        |             |Image.image  |                        |                                 |
|                        |             |_id          |                        |                                 |
+------------------------+-------------+-------------+------------------------+---------------------------------+
|Tag                     |             |FK:          |                        |$snapshot/images/$image/         |
|                        |             |tag.project, |                        |manifest.xml/<path>,             |
|                        |             |tag.tag      |                        |$snapshot/images/$image/         |
|                        |             |             |                        |manifest.xml/<revision>.start    |
+------------------------+-------------+-------------+------------------------+---------------------------------+


Raw Events Data
===============

Gerrit
------

Obtain change data by using Gerrit RESTful API.

For more information, refer to `REST API - Changes`_.

An sample JSON file offered by the API is shown below:

Changes
```````
::

    {
        "kind": "gerritcodereview#change",
        "id": "framework%2Ftelephony%2Flibslp-tapi~tizen_2.1~I820c9483ee16b73d1d49230dfcdc99e049c6db26",
        "project": "framework/telephony/libslp-tapi",
        "branch": "tizen_2.1",
        "change_id": "I820c9483ee16b73d1d49230dfcdc99e049c6db26",
        "subject": "Fix hardcoding library path for 64 bit compatibility.",
        "status": "SUBMITTED",
        "created": "2013-04-02 07:50:37.000000000",
        "updated": "2013-11-20 17:35:10.000000000",
        "mergeable": false,
        "_sortkey": "00293c9f0000dcfc",
        "_number": 56572,
        "owner": {
          "name": "fangx.li"
        },
        "labels": {
          "Verified": {
            "approved": {
              "name": "fangx.li"
            }
          },
          "Code-Review": {
            "approved": {
              "name": "Anas Nashif"
            }
          }
        },
        "current_revision": "85227f93ecc8283b3606c997c3ca38dc0b774d86",
        "revisions": {
          "85227f93ecc8283b3606c997c3ca38dc0b774d86": {
            "_number": 2,
            "fetch": {
              "http": {
                "url": "https://review.tizendev.org/gerrit/framework/telephony/libslp-tapi",
                "ref": "refs/changes/72/56572/2"
              },
              "ssh": {
                "url": "ssh://review.tizendev.org:29418/framework/telephony/libslp-tapi",
                "ref": "refs/changes/72/56572/2"
              }
            },
            "commit": {
              "parents": [
                {
                  "commit": "aa31f300cc899f9d5aa6599d1cb9f6cbbe8740fd",
                  "subject": "Add tapitest"
                }
              ],
              "author": {
                "name": "Junfeng Dong",
                "email": "junfeng.dong@intel.com",
                "date": "2013-03-29 05:38:39.000000000",
                "tz": 480
              },
              "committer": {
                "name": "Guillaume Zajac",
                "email": "guillaume.zajac@linux.intel.com",
                "date": "2013-04-02 09:46:21.000000000",
                "tz": 120
              },
              "subject": "Fix hardcoding library path for 64 bit compatibility.",
              "message": "Fix hardcoding library path for 64 bit compatibility.\n\nChange-Id: I820c9483ee16b73d1d49230dfcdc99e049c6db26\n"
            }
          }
        }
      }


+------------------------------------+-------------------------------+------------------------+
|Event field                         |DB Field                       |Note                    |
+====================================+===============================+========================+
|res._number                         |Change.Number                  |                        |
+------------------------------------+-------------------------------+------------------------+
|res.project                         |Change.Project                 |                        |
+------------------------------------+-------------------------------+------------------------+
|res.branch                          |Change.Branch                  |                        |
+------------------------------------+-------------------------------+------------------------+
|res.revisions.patchset._number      |Change.Merged_patchset_number  |                        |
+------------------------------------+-------------------------------+------------------------+
|res.subject                         |Change.Subject                 |                        |
+------------------------------------+-------------------------------+------------------------+
|res.owner.name                      |Change.Owner                   |                        |
+------------------------------------+-------------------------------+------------------------+
|res._number                         |Change.Number                  |                        |
+------------------------------------+-------------------------------+------------------------+
|res.project                         |Change.Number                  |                        |
+------------------------------------+-------------------------------+------------------------+
|res.id                              |Change.Change_id               |                        |
+------------------------------------+-------------------------------+------------------------+
|res.created                         |Change.Created_at              |                        |
+------------------------------------+-------------------------------+------------------------+
|res.updated                         |Change.Updated_at              |                        |
+------------------------------------+-------------------------------+------------------------+
|res.status                          |Change.Status                  |                        |
+------------------------------------+-------------------------------+------------------------+
|res.revisions.patchset              |Patchset.id                    |                        |
+------------------------------------+-------------------------------+------------------------+
|res.revisions.commit.subject        |Patchset.Subject               |                        |
+------------------------------------+-------------------------------+------------------------+
|res.revisions.patchset._number      |Patchset.Number                |                        |
+------------------------------------+-------------------------------+------------------------+
|res.revisions.commit.committer      |Patchset.Uploader              |                        |
+------------------------------------+-------------------------------+------------------------+
|res.revisions.patchset              |Patchset.Commit                |                        |
+------------------------------------+-------------------------------+------------------------+
|res.revisions.commit.committer.date |Patchset.Created_at            |                        |
+------------------------------------+-------------------------------+------------------------+


OBS
---

OSC get request
```````````````

Event example

::

    equest: #3259

      submit:       Tizen:2.2:Main:build/apps.Calendar(cleanup) -> Tizen:2.2:Main


      Message:
      Submitter: Amith Kumar Mahale <amith.m@samsung.com>
      Comments: Fix for N_SE-51444 N_SE-51423 N_SE-51500 N_SE-51693
      Git project: apps/osp/Calendar
      Tag: submit/tizen_2.2/20130912.090557
      Commit: fc5caf47dc53fb31de95ec88b974090e2f4659f5 Fix for N_SE-51693

      State:   accepted   2013-09-12T15:40:14 hosang.kim
      Comment: 2.2.1 RC10 R1

      History: new        2013-09-12T08:59:08 rsarobot

+------------------------+-------------+-------------+------------------------+---------------------------------+
|field                   |type         |key/index    |note                    |data source                      |
+========================+=============+=============+========================+=================================+
|Tag                     |             |             |                        |OSC_SR.description.tag           |
+------------------------+-------------+-------------+------------------------+---------------------------------+
|Target_project          |Varchar(255) |             |                        |OSC_SR.action. tgt_project       |
+------------------------+-------------+-------------+------------------------+---------------------------------+
|Target_package          |Varchar(255) |             |                        |OSC_SR.action.tgt_package        |
+------------------------+-------------+-------------+------------------------+---------------------------------+
|Source_project          |Varchar(255) |             |                        |OSC_SR.action.src_project        |
+------------------------+-------------+-------------+------------------------+---------------------------------+
|Source_package          |Varchar(255) |             |                        |OSC_SR.action.src_package        |
+------------------------+-------------+-------------+------------------------+---------------------------------+
|Source_revision         |Varchar(64)  |             |                        |OSC_SR.action.src_rev            |
+------------------------+-------------+-------------+------------------------+---------------------------------+
|Status                  |Varchar(64)  |             |- Sent                  |OSC_SR.state.name                |
|                        |             |             |- Created               |                                 |
|                        |             |             |- Accepted              |                                 |
|                        |             |             |- Revoked               |                                 |
|                        |             |             |- Rejected              |                                 |
+------------------------+-------------+-------------+------------------------+---------------------------------+

.. _`REST API - Changes`: https://gerrit-review.googlesource.com/Documentation/rest-api-changes.html
